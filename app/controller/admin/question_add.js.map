{
    "version": 3,
    "sources": [
        "../../../src/controller/admin/question_add.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "get",
        "question",
        "model",
        "where",
        "id",
        "find",
        "options",
        "question_id",
        "select",
        "assign",
        "display",
        "addAction",
        "q_id",
        "isPut",
        "isMethod",
        "isPost",
        "data",
        "post",
        "c",
        "JSON",
        "parse",
        "s",
        "console",
        "log",
        "stringify",
        "questionData",
        "title",
        "type",
        "max_scores",
        "add",
        "forEach",
        "item",
        "index",
        "content",
        "scores",
        "push",
        "rows",
        "addMany",
        "success",
        "affectedRows",
        "oIds",
        "update",
        "updateMany"
    ],
    "mappings": "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",
    "file": "../../../src/controller/admin/question_add.js",
    "sourcesContent": [
        "const Base = require('../base.js');\n\nmodule.exports = class extends Base {\n async indexAction() {\n\n    if (this.get(\"id\") != null){\n      const question = await this.model('question').where({ id: this.get(\"id\") }).find();\n      const options = await this.model('options').where({ question_id: this.get(\"id\") }).select();\n\n      this.assign({\n        question: question,\n        options:options\n      });\n    }else {\n      this.assign({\n        question: null,\n        options:null\n      });\n    }\n\n    return this.display();\n  }\n  async addAction(){\n    const q_id = this.get(\"id\");\n    const isPut = this.isMethod('PUT');\n    const isPost = this.isMethod('POST');\n    const data = this.post();\n    data.c =  JSON.parse(data.c)\n    data.s =  JSON.parse(data.s)\n    // JSON.parse(data)\n    console.log('============:', JSON.stringify(data) );\n    let questionData = {\n      title:data.title,\n      type:data.type,\n      max_scores:data.max_scores\n    };\n    if (isPost) {\n      var question_id = await this.model('question').add(questionData);\n      if (question_id > 0){\n        let options = [];\n        data.c.forEach(function(item,index){\n          let model = {\n            question_id:question_id,\n            content:data.c[index],\n            scores:data.s[index]\n          }\n          options.push(model);\n        });\n        const rows = await this.model('options').addMany(options);\n        return this.success({ affectedRows: rows });\n      }\n    }\n    if (isPut) {\n      data.oIds =  JSON.parse(data.oIds);//options ids\n      var question_id = await this.model('question').where({ id: q_id }).update(questionData);\n      if (question_id > 0){\n        let options = [];\n        data.c.forEach(function(item,index){\n          let model = {\n            id:data.oIds[index],\n            question_id:q_id,\n            content:data.c[index],\n            scores:data.s[index]\n          }\n          options.push(model);\n        });\n        const rows = await this.model('options').updateMany(options);\n        return this.success({ affectedRows: rows });\n      }\n    }\n  }\n};\n"
    ]
}