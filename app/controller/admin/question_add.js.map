{
    "version": 3,
    "sources": [
        "../../../src/controller/admin/question_add.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "get",
        "question",
        "model",
        "where",
        "id",
        "find",
        "options",
        "question_id",
        "select",
        "assign",
        "display",
        "addAction",
        "q_id",
        "isPut",
        "isMethod",
        "isPost",
        "data",
        "post",
        "c",
        "JSON",
        "parse",
        "s",
        "console",
        "log",
        "stringify",
        "questionData",
        "title",
        "orderby",
        "type",
        "max_scores",
        "add",
        "forEach",
        "item",
        "index",
        "content",
        "scores",
        "push",
        "rows",
        "addMany",
        "success",
        "affectedRows",
        "oIds",
        "update",
        "updateMany"
    ],
    "mappings": "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",
    "file": "../../../src/controller/admin/question_add.js",
    "sourcesContent": [
        "const Base = require('../base.js');\n\nmodule.exports = class extends Base {\n async indexAction() {\n\n    if (this.get(\"id\") != null){\n      const question = await this.model('question').where({ id: this.get(\"id\") }).find();\n      const options = await this.model('options').where({ question_id: this.get(\"id\") }).select();\n\n      this.assign({\n        question: question,\n        options:options\n      });\n    }else {\n      this.assign({\n        question: null,\n        options:null\n      });\n    }\n\n    return this.display();\n  }\n  async addAction(){\n    const q_id = this.get(\"id\");\n    const isPut = this.isMethod('PUT');\n    const isPost = this.isMethod('POST');\n    const data = this.post();\n    data.c =  JSON.parse(data.c)\n    data.s =  JSON.parse(data.s)\n    // JSON.parse(data)\n    console.log('============:', JSON.stringify(data) );\n    let questionData = {\n      title:data.title,\n      orderby:data.orderby,\n      type:data.type,\n      max_scores:data.max_scores\n    };\n    if (isPost) {\n      var question_id = await this.model('question').add(questionData);\n      if (question_id > 0){\n        let options = [];\n        data.c.forEach(function(item,index){\n          let model = {\n            question_id:question_id,\n            content:data.c[index],\n            scores:data.s[index]\n          }\n          options.push(model);\n        });\n        const rows = await this.model('options').addMany(options);\n        return this.success({ affectedRows: rows });\n      }\n    }\n    if (isPut) {\n      data.oIds =  JSON.parse(data.oIds);//options ids\n      var question_id = await this.model('question').where({ id: q_id }).update(questionData);\n      if (question_id > 0){\n        let options = [];\n        data.c.forEach(function(item,index){\n          let model = {\n            id:data.oIds[index],\n            question_id:q_id,\n            content:data.c[index],\n            scores:data.s[index]\n          }\n          options.push(model);\n        });\n        const rows = await this.model('options').updateMany(options);\n        return this.success({ affectedRows: rows });\n      }\n    }\n  }\n};\n"
    ]
}