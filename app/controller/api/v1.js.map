{
    "version": 3,
    "sources": [
        "../../../src/controller/api/v1.js"
    ],
    "names": [
        "Base",
        "require",
        "fs",
        "ALY",
        "ossStream",
        "OSS",
        "accessKeyId",
        "secretAccessKey",
        "endpoint",
        "apiVersion",
        "module",
        "exports",
        "indexAction",
        "json",
        "code",
        "loginAction",
        "username",
        "post",
        "password",
        "undefined",
        "fail",
        "passwordMd5Val",
        "think",
        "md5",
        "user",
        "model",
        "data",
        "where",
        "find",
        "JSON",
        "stringify",
        "success",
        "userAction",
        "isPut",
        "isMethod",
        "isPost",
        "id",
        "get",
        "rows",
        "update",
        "affectedRows",
        "isUser",
        "add",
        "upfileAction",
        "file",
        "filePath",
        "uuid",
        "upload",
        "Bucket",
        "Key",
        "read",
        "createReadStream",
        "path",
        "pipe",
        "_this",
        "p",
        "Promise",
        "resolve",
        "reject",
        "on",
        "details",
        "console",
        "log",
        "then",
        "error",
        "evaluationAction",
        "isGet",
        "isDelete",
        "delete",
        "select",
        "questionAction",
        "optionsAction",
        "answerAction"
    ],
    "mappings": "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",
    "file": "../../../src/controller/api/v1.js",
    "sourcesContent": [
        "const Base = require('../base.js');\n\n//阿里云\nvar fs = require(\"fs\");\nvar ALY = require('aliyun-sdk');\nvar ossStream = require('aliyun-oss-upload-stream')(new ALY.OSS({\n  accessKeyId: 'yIgRvLsyxFB3JEJH',\n  secretAccessKey: 'X7wyFWIw76cLb4cLNDa8Z2YNmHtIOu',\n  endpoint: 'http://oss-cn-beijing.aliyuncs.com',\n  apiVersion: '2013-10-15'\n}));\n\n\nmodule.exports = class extends Base {\n  indexAction() {\n    return this.json({code:200});\n  }\n  //登录\n  async loginAction() {\n     const username = this.post('username');\n     const password = this.post('password');\n     if (username == undefined || password == undefined) {\n       return this.fail(300, \"参数错误\");\n     }\n     const passwordMd5Val = think.md5(password);\n     const user = this.model('user');\n     const data = await user.where({\n       username: username,\n       password: passwordMd5Val\n     }).find();\n     // this.json(data)\n     if (JSON.stringify(data) == \"{}\"){\n        return this.fail(300, \"账户名或者密码错误！\");\n     }\n     else {\n        return this.success(200, \"登录成功！\");\n     }\n  }\n  //用户注册和更改用户资料\n  async userAction(){\n    const isPut = this.isMethod('PUT');\n    const isPost = this.isMethod('POST');\n\n    const model = this.model('user');\n    const id = this.get(\"id\");\n\n    if (isPut) {\n      const data = this.post();\n      data.password =  think.md5(data.password);\n      const rows = await model.where({ id: id }).update(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isPost) {\n      const data = this.post();\n      data.password =  think.md5(data.password);\n      // this.json(data)\n      const isUser = await model.where({username: data.username}).find();\n        if (JSON.stringify(isUser) != \"{}\"){\n          return this.fail(1001, \"注册失败！该用户已经存在\");\n        }else {\n          const rows = await model.add(data);\n          return this.success({ affectedRows: rows });\n        }\n    }\n  }\n  //上传文件\n  async upfileAction(){\n    var file = this.file(\"file\")\n    var filePath = \"baby/\" + think.uuid(\"v4\") + \".jpg\";\n    var upload = ossStream.upload({\n      Bucket: 'server-19860911',\n      Key: filePath\n    });\n    var read = fs.createReadStream(file.path);\n    read.pipe(upload);\n    var _this = this\n    //传成功\n    var p = await new Promise((resolve,reject)=>{\n        upload.on('uploaded', function (details) {\n           console.log('details:', details);\n           resolve(details)\n         });\n     }).then(function(details){\n           _this.json(details);\n     })\n     //传失败\n     upload.on('error', function (error) {\n       console.log('error:', error);\n     });\n  }\n\n  //Evaluation 评测主体\n  async evaluationAction(){\n    const isGet = this.isMethod('GET');\n    const isPut = this.isMethod('PUT');\n    const isPost = this.isMethod('POST');\n    const isDelete = this.isMethod('DELETE');\n    const model = this.model('evaluation');\n    const id = this.get(\"id\");\n    if (isPut) {\n      const data = this.post();\n      const rows = await model.where({ id: id }).update(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isPost) {\n      const data = this.post();\n      const rows = await model.add(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isDelete) {\n      const rows = await model.where({ id: id }).delete()\n      return this.success({ affectedRows: rows });\n    }\n    if (isGet) {\n      const data = await model.select()\n      return this.json(data);\n    }\n  }\n\n  //question\n  async questionAction(){\n    const isGet = this.isMethod('GET');\n    const isPut = this.isMethod('PUT');\n    const isPost = this.isMethod('POST');\n    const isDelete = this.isMethod('DELETE');\n    const model = this.model('question');\n    const id = this.get(\"id\");\n    if (isPut) {\n      const data = this.post();\n      const rows = await model.where({ id: id }).update(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isPost) {\n      const data = this.post();\n      const rows = await model.add(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isDelete) {\n      const rows = await model.where({ id: id }).delete()\n      return this.success({ affectedRows: rows });\n    }\n    if (isGet) {\n      const data = await model.select()\n      return this.json(data);\n    }\n  }\n  //options\n  async optionsAction(){\n    const isGet = this.isMethod('GET');\n    const isPut = this.isMethod('PUT');\n    const isPost = this.isMethod('POST');\n    const isDelete = this.isMethod('DELETE');\n    const model = this.model('options');\n    const id = this.get(\"id\");\n    if (isPut) {\n      const data = this.post();\n      const rows = await model.where({ id: id }).update(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isPost) {\n      const data = this.post();\n      const rows = await model.add(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isDelete) {\n      const rows = await model.where({ id: id }).delete()\n      return this.success({ affectedRows: rows });\n    }\n    if (isGet) {\n      const data = await model.select()\n      return this.json(data);\n    }\n  }\n  //Answer\n  async answerAction(){\n    const isGet = this.isMethod('GET');\n    const isPut = this.isMethod('PUT');\n    const isPost = this.isMethod('POST');\n    const isDelete = this.isMethod('DELETE');\n    const model = this.model('answer');\n    const id = this.get(\"id\");\n    if (isPut) {\n      const data = this.post();\n      const rows = await model.where({ id: id }).update(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isPost) {\n      const data = this.post();\n      const rows = await model.add(data);\n      return this.success({ affectedRows: rows });\n    }\n    if (isDelete) {\n      const rows = await model.where({ id: id }).delete()\n      return this.success({ affectedRows: rows });\n    }\n    if (isGet) {\n      const data = await model.select()\n      return this.json(data);\n    }\n  }\n};\n"
    ]
}